<!DOCTYPE html>
<html lang="en" Theme="blue_material" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Locations</title>
    <script src="../bridge/android.js"></script>
    <script src="../database/MainDataBase.js"></script>
    <link rel="stylesheet" href="../ui-files/font-usage.css">
    <link rel="stylesheet" href="../ui-files/variables.css">
    <link rel="stylesheet" href="../components/components.css">
    <link rel="stylesheet" href="../components/modal-ver.css">
    <link rel="stylesheet" href="../ripple-files/ripple.css">
    <link rel="stylesheet" href="../components/segment-btns.css">
    <script src="../langs/langs.js"></script>
    <script>
          if(localStorage.getItem('useLightTheme') && localStorage.getItem('useLightTheme') === 'true'){
        document.documentElement.setAttribute('colorTheme', 'light');
        }
  </script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-user-drag: none;
            outline: none;
        }

        p {
            margin: 0;
        }

        body {
            background-color: var(--Surface);
            padding: 0;
            margin: 0;
            overflow: hidden;
            font-family: var(--outfit);
            animation: opacity 0.3s ease-out;

        }

        @keyframes opacity {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        [hidden] {
            display: none !important;
        }

        *::selection {
            background-color: var(--Inverse-Primary);
            color: white;
        }

        .location_item {
            min-height: calc(65px - 20px);
            display: flex;
            align-items: center;
            padding: 10px;
            padding-left: 16px;
            padding-right: 16px;
            gap: 15px;
            position: relative;
            margin: 10px 12px;
            background-color: var(--Surface-Container-Low);
            border-radius: 50px;
             overflow: hidden;
        }

        .location_item .icon svg {
            width: 40px;
            height: 40px;
            fill: var(--Tertiary);
            transition: fill 0.2s ease-out;
        }

        .location_item edit-option{
          z-index: 1;
          position: absolute;
          right: 16px;
        }

        .location_item p {
            font-size: 16px;
            color: var(--On-Surface);
            font-family: var(--google-mid);
            max-width: calc(100% - 120px);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .location_item p customNameText{
          font-size: 13px;
          font-family: var(--outfit);
          opacity: 0.7;
          white-space: nowrap;
        width: calc(100% - 0px);
        overflow: hidden;
        text-overflow: ellipsis;
        }


        .item_holder {
            padding-top: 20px;
            padding-bottom: 20px;
        }

        .not-selected {
            position: absolute;
            font-size: 24px;
            color: var(--On-Tertiary);
            z-index: 1;

        }

        .selected {
            position: absolute;
            font-size: 24px;
            color: var(--On-Primary);
            display: none;
            z-index: 1;
        }

        .location_item .icon {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .selected-home-location > .icon svg{
            fill: var(--Primary);
        }

        .selected-home-location > .icon .selected{
            display: flex;
        }

        .selected-home-location > .icon .not-selected{
            display: none;
        }

        .selected-home-location{
            background-color: var(--Primary-Container);
        }
                .selected-home-location p {
            font-size: 16px;
            color: var(--On-Primary-Container);
            font-family: var(--google-mid);
            max-width: calc(100% - 120px);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .info_div{
            padding-left: 13px;
            padding-right: 13px;
            padding-top: 5px;
            padding-bottom: 5px;
            display: flex;
            align-items: flex-start;
            gap: 3px;
            color: var(--On-Surface-Variant);
            opacity: 0.7;
            font-size: 14px;
        }

        .info_div md-icon{
            font-size: 18px;
            width: max-content;
            height: max-content;
        }

                .used_storage{
            display: flex;
            padding: 12px;
            padding-bottom: 0;
        }

        .used_storage.lowStorage .storage_container{
            border: 2px solid rgb(0, 255, 0);
        }

        .used_storage.lowStorage .storage_container .storage_progress{
            background-color: rgba(84, 245, 84, 0.438);
        }

        /* mid */


        .used_storage.midStorage .storage_container{
            border: 2px solid rgb(255, 230, 0);
        }

        .used_storage.midStorage .storage_container .storage_progress{
            background-color: rgba(245, 221, 84, 0.438);
        }

        /* high */

        .used_storage.highStorage .storage_container{
            border: 2px solid rgb(255, 0, 0);
        }

        .used_storage.highStorage .storage_container .storage_progress{
            background-color: rgba(245, 84, 84, 0.438);
        }

        .used_storage .storage_container{
            background-color: var(--Surface-Container-Low);
            width: 100%;
            height: calc(55px - 3px);
            border-radius: 50px;
            position: relative;
            overflow: hidden;
            border: 2px solid;


        }

        .used_storage .storage_container .storage_progress{
            position: absolute;
            height: 100%;
            transition: all 1s ease-out;
            left: 0;
            top: 0;
            width: 0%;
        }

        #storage_progress_text{
            position: absolute;
            font-size: 24px;
            font-family: var(--google-mid);
            top: 50%;
            left: 20px;
            color: var(--On-Surface);
            transform: translateY(-50%);
        }

        .used_span_supporting{
            font-size: 14px;
            font-family: var(--google-normal);
            color: var(--On-Surface-Variant);
            opacity: 0.69;
        }

                .activity-large-content::before {
            position: fixed;
            bottom: 0;
            content: '';
            width: 100%;
            background: linear-gradient(0deg, var(--Surface) 10%, rgba(255, 0, 0, 0));
            height: 30px;
            z-index: 1;
        }

                ripple-container_fake{
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
        }


    </style>
</head>

<body hidden>

    <div class="activity-large open">
        <div class="header-activity-large" id="head-1">
            <button class="ripple-icon-btn regular" ontouchstart="playEffect(this)" ontouchend="playEffect2(this)"
                title="Go back" onclick="ActivityBack()">
                <span class="ripple-effect-icon"></span>
                <span icon-outlined>arrow_back</span>
            </button>
            <p class="label-hidden-large" style="white-space: nowrap;" data-translate="home_location">Home location</p>
            <flex style="flex: 1;"></flex>

            <button class="ripple-icon-btn regular" onclick="openDeletelocationsDialog()" ontouchstart="playEffect(this)" ontouchend="playEffect2(this)"
                    title="Delete locations">
                <span class="ripple-effect-icon"></span>
                <span icon-outlined>delete</span>
            </button>
        </div>
        <div class="activity-large-content" id="headUser-1">
            <p class="label-large-main" data-translate="home_location">Home location</p>
            <div class="content-parent-large" style="padding-bottom: 32px;">

                <div class="info_div">
                    <md-icon icon-outlined>info</md-icon>
                    <span data-translate="info_home_location_tip">You need to save locations to use them as your default location</span>
                </div>

                <div class="used_storage">
                    <div class="storage_container">
                        <div class="storage_progress"></div>
                        <p id="storage_progress_text" style="display: flex ; justify-content: flex-start; align-items: flex-end; width: calc(100% - 80px); gap: 2.5px;"><span id="storage_progress_text_span"></span><span class="used_span_supporting" data-translate="used_app_storage" style="overflow: hidden; display: block; width: calc(100% - 70px); text-overflow: ellipsis; white-space: nowrap; padding-bottom: 2px;">Used app storage</span></p>
                        <div style="position: absolute; top: 50%; transform: translateY(-50%); right: 10px;">
                            <md-icon-button onclick="openInfoDialog()"><md-icon icon-outlined>info</md-icon></md-icon-button></div>
                    </div>
                </div>

                <div class="item_holder" id="item_holder">

                    

                </div>


                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>

                <md-dialog style="min-width: 85%;" id="storage_info_dialog">
                    <div slot="headline" data-translate="used_app_storage">Used app storage</div>
                    <div slot="content" data-translate="used_app_storage_info_sub">
                        Storage shows how much of the available space the app is using for saved locations. If it reaches 100%, you can no longer save additional locations
                    </div>
                    <div slot="actions">
                        <md-text-button data-translate="ok" onclick="window.history.back()">OK</md-text-button>
                    </div>
                </md-dialog>


                <md-dialog style="min-width: 85%;" id="delete_all_locations_dialog">
                    <div slot="headline" data-translate="delete_locations">Delete locations</div>
                    <div slot="content" data-translate="delete_locations_support_sub">
                        This action removes every saved location except your default location. Use this if your saved locations are not visible, are duplicating, or experiencing any other bugs
                    </div>
                    <div slot="actions">
                        <md-text-button onclick="window.history.back()" style="font-size: 16px;" data-translate="cancel">Cancel</md-text-button>
                        <md-filled-button onclick="deleteSavedLocations();" style="font-size: 16px;" id="delete_all_locations_btn" data-translate="delete">Delete</md-filled-button>
                    </div>
                </md-dialog>

                <md-dialog style="min-width: 85%;" id="editLocationNameDialog">
                    <div slot="headline" data-translate="edit_location_headline">Edit location</div>

                    <div slot="content">
                        <md-outlined-text-field id="inputLocationName" style="width: 100%;" error-text="Please fill in the field or reset it">
                            <md-icon-button slot="trailing-icon" onclick="resetLocationCustomName()">
                                <md-icon icon-outlined style="color: var(--Secondary);">refresh</md-icon>
                            </md-icon-button>

                        </md-outlined-text-field>
                    </div>

                    <div slot="actions">
                        <md-text-button  data-translate="cancel" onclick="window.history.back()">Cancel</md-text-button>
                        <md-text-button data-translate="save" onclick="saveCustomLocatioName()">Save</md-text-button>
                    </div>
                </md-dialog>

            </div>
        </div>
    </div>


    <script>
        renderSavedLocationsHome();

    function hexToRgb(hex) {
    const bigint = parseInt(hex.slice(1), 16);
    return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255
    };
}

function rgbToHsl({ r, g, b }) {
    r /= 255;
    g /= 255;
    b /= 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
        h = s = 0; // Achromatic
    } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }

    return { h: h * 360, s: s * 100, l: l * 100 };
}

async function CreateMaterialYouTheme(hex) {
    const colors = {
        orange_material: "#FFA500",
        red_material: "#FF0000",
        pink_material: "#FFC0CB",
        purple_material: "#800080",
        blue_material: "#0000FF",
        yellow_material: "#FFFF00",
        green_material: "#008000",
        mono_material: "#e2e2e2"
    };

    const targetHsl = rgbToHsl(hexToRgb(hex));
    let closestColor = null;
    let smallestHueDifference = Infinity;

    for (const [color, colorHex] of Object.entries(colors)) {
        const colorHsl = rgbToHsl(hexToRgb(colorHex));
        const hueDifference = Math.abs(targetHsl.h - colorHsl.h);
        if (targetHsl.s < 10) {
            closestColor = "mono_material";
            break;
        }
        if (hueDifference < smallestHueDifference) {
            smallestHueDifference = hueDifference;
            closestColor = color;
        }
    }

 if(localStorage.getItem("useDynamicColors") && localStorage.getItem("useDynamicColors") === "false"){
  if (await customStorage.getItem("customTheme")) {
    document.documentElement.setAttribute(
      "Theme",
      await customStorage.getItem("customTheme")
    );
  } else{
    document.documentElement.setAttribute(
     "Theme",
        "blue_material"
   );
     await customStorage.setItem("customTheme", "blue_material");
  }

      if(localStorage.getItem('useLightTheme') && localStorage.getItem('useLightTheme') === 'true'){
        document.documentElement.setAttribute('colorTheme', 'light');
        sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '1')

      } else{
        document.documentElement.setAttribute('colorTheme', 'dark');
        sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '0')
      }
        document.querySelector('body').hidden = false

  } else{
    document.documentElement.setAttribute('Theme', closestColor);

if(localStorage.getItem('useLightTheme') && localStorage.getItem('useLightTheme') === 'true'){
  document.documentElement.setAttribute('colorTheme', 'light');
  sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '1')

} else{
  document.documentElement.setAttribute('colorTheme', 'dark');
  sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '0')
}
  document.querySelector('body').hidden = false
  }
}

        const user1 = document.getElementById('headUser-1')

        function changeColorOnScroll1() {
            var container = document.getElementById('headUser-1');
            var scrollY = container.scrollTop;

            if (scrollY >= 50) {
                document.getElementById('head-1').style.backgroundColor = 'var(--Surface-Container)';
                document.getElementById('head-1').style.transition = '';

                document.getElementById('headUser-1').style.scrollSnapType = 'unset';
                container.removeEventListener('scroll', changeColorOnScroll1);
            sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface-Container'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '220')



            } else {

            }
        }

        if (user1) {
            document.getElementById('headUser-1').addEventListener('scroll', changeColorOnScroll1);
        }



        function changeColorOnScroll1A() {
            var container = document.getElementById('headUser-1');
            var scrollY = container.scrollTop;

            if (scrollY <= 1) {
                document.getElementById('head-1').style.backgroundColor = '';
                document.getElementById('head-1').style.transition = 'background-color 0.2s ease-in';

              sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '220')


                container.addEventListener('scroll', changeColorOnScroll1);
                if (scrollY <= 20); {
                    document.getElementById('headUser-1').style.scrollSnapType = '';

                }

            } else {

            }
        }

        if (user1) {
            document.getElementById('headUser-1').addEventListener('scroll', changeColorOnScroll1A);
        }


        // render locations

                          let local

  if (
    localStorage.getItem("AppLanguageCode") === '' ||
    localStorage.getItem("AppLanguageCode") === 'nl' || // Dutch
    localStorage.getItem("AppLanguageCode") === 'fr' || // French
    localStorage.getItem("AppLanguageCode") === 'de' || // German
    localStorage.getItem("AppLanguageCode") === 'el' || // Greek
    localStorage.getItem("AppLanguageCode") === 'it' || // Italian
    localStorage.getItem("AppLanguageCode") === 'fa' || // Persian
    localStorage.getItem("AppLanguageCode") === 'pl' || // Polish
    localStorage.getItem("AppLanguageCode") === 'pt' || // Portuguese
    localStorage.getItem("AppLanguageCode") === 'ro' || // Romanian
    localStorage.getItem("AppLanguageCode") === 'ru' || // Russian
    localStorage.getItem("AppLanguageCode") === 'es' || // Spanish
    localStorage.getItem("AppLanguageCode") === 'tr' || // Turkish
    localStorage.getItem("AppLanguageCode") === 'uk' || // Ukrainian
    localStorage.getItem("AppLanguageCode") === 'sr' || // Serbian
    localStorage.getItem("AppLanguageCode") === 'az' || // Azerbaijani
    localStorage.getItem("AppLanguageCode") === 'sl' || // Slovenian
    localStorage.getItem("AppLanguageCode") === 'fi' || // Finnish
    localStorage.getItem("AppLanguageCode") === 'hu' ||  // Hungarian
    localStorage.getItem("AppLanguageCode") === 'cs'    // Czech
  ) {
    local = ','
  } else{
    local = '.'

  }


  function setCurrentLocation(value){
    renderSavedLocationsHome(value)
  }

      function renderSavedLocationsHome(value){
        const savedLocationsMenu = document.getElementById('item_holder');
        const savedLocations = JSON.parse(localStorage.getItem('savedLocations')) || [];

        savedLocationsMenu.innerHTML = ''

        const clearSelection = () => {
            const allMenuItems = savedLocationsMenu.querySelectorAll('div');
            allMenuItems.forEach(item => item.classList.remove('selected-home-location'));
        };

        const defaultMenuItem = document.createElement('div');
        defaultMenuItem.setAttribute('lat', 'defaultLat');
        defaultMenuItem.setAttribute('lon', 'defaultLon');
        defaultMenuItem.innerHTML = getTranslationByLang(localStorage.getItem("AppLanguageCode"), 'your_device_location');
        defaultMenuItem.classList.add('selected-home-location', 'location_item', 'device_location');
        defaultMenuItem.setAttribute('name', 'CurrentDeviceLocation');
        defaultMenuItem.addEventListener('click', () =>{
            AndroidFunctionActivityInterface.androidFunction('homeLocationLocationReq');
        })
        defaultMenuItem.innerHTML = `

                <div class="icon">
                <svg _ngcontent-dfa-c17="" width="100%" height="100%" viewBox="0 0 40 40" fill="none"
                    xmlns="http://www.w3.org/2000/svg" class="clover ng-star-inserted">
                    <path _ngcontent-dfa-c17=""
                        d="M.887 14.467C-2.845 5.875 5.875-2.845 14.467.887l1.42.617a10.323 10.323 0 0 0 8.225 0l1.42-.617c8.593-3.732 17.313 4.988 13.581 13.58l-.617 1.42a10.323 10.323 0 0 0 0 8.225l.617 1.42c3.732 8.593-4.989 17.313-13.58 13.581l-1.42-.617a10.323 10.323 0 0 0-8.225 0l-1.42.617C5.874 42.845-2.846 34.125.886 25.533l.617-1.42a10.323 10.323 0 0 0 0-8.225l-.617-1.42Z">
                    </path>
                </svg>
                <i icon-filled class="not-selected">my_location</i>
                <i icon-outlined class="selected">check</i>
                </div>
                <p data-translate="your_device_location" style="max-width: unset;">Your device location</p>

                <md-ripple style="--md-ripple-pressed-opacity: 0.05 !important;"></md-ripple>
                `


                if(value){
                  turnOnCurrentLocation()
                  console.log("value is available")
                } else{
                  console.log("value isn't available")
                }

        function turnOnCurrentLocation(){
            clearSelection();
            defaultMenuItem.classList.add('selected-home-location');
            localStorage.setItem('DefaultLocation', JSON.stringify({ lat: localStorage.getItem('deviceLat'), lon: localStorage.getItem('devicelon'), name: 'CurrentDeviceLocation' }));
        }


        savedLocationsMenu.appendChild(defaultMenuItem);


        const uniqueLocations = {};

      const uniqueSavedLocations = savedLocations.filter(location => {
        if (!uniqueLocations[location.locationName]) {
          uniqueLocations[location.locationName] = true;
          return true;
        }
        return false;
      });

        uniqueSavedLocations.forEach(location => {
            const menuItemLocation = document.createElement('div');
            menuItemLocation.classList.add("location_item")
            menuItemLocation.setAttribute('lat', location.lat);
            menuItemLocation.setAttribute('lon', location.lon);
            menuItemLocation.setAttribute('name', location.locationName);
            const savedLocationsCustom = JSON.parse(localStorage.getItem("savedLocationsCustomName"));

            menuItemLocation.innerHTML = `

                        <div class="icon">
                            <svg _ngcontent-dfa-c17="" width="100%" height="100%" viewBox="0 0 40 40" fill="none"
                                xmlns="http://www.w3.org/2000/svg" class="clover ng-star-inserted">
                                <path _ngcontent-dfa-c17=""
                                    d="M.887 14.467C-2.845 5.875 5.875-2.845 14.467.887l1.42.617a10.323 10.323 0 0 0 8.225 0l1.42-.617c8.593-3.732 17.313 4.988 13.581 13.58l-.617 1.42a10.323 10.323 0 0 0 0 8.225l.617 1.42c3.732 8.593-4.989 17.313-13.58 13.581l-1.42-.617a10.323 10.323 0 0 0-8.225 0l-1.42.617C5.874 42.845-2.846 34.125.886 25.533l.617-1.42a10.323 10.323 0 0 0 0-8.225l-.617-1.42Z">
                                </path>
                            </svg>
                            <i icon-filled class="not-selected">location_on</i>
                            <i icon-outlined class="selected">check</i>
                        </div>
                        <p>${location.locationName}
                        <customNameText>${savedLocationsCustom?.[location.locationName] || ''}</customNameText>
                        </p>

                        <ripple-container_fake>
                        <md-ripple style="--md-ripple-pressed-opacity: 0.05 !important;"></md-ripple>
                          </ripple-container_fake>
                        <edit-option>
                          <md-icon-button editLocationName="${location.locationName}" customName="${savedLocationsCustom?.[location.locationName] || location.locationName}" OriginaleditLocationName="${location.locationName}" onclick="editLocationName(event)">
                            <md-icon icon-outlined>edit</md-icon>
                            </md-icon-button>
                          </edit-option>
            `


            menuItemLocation.addEventListener('click', () => {
                clearSelection();
                menuItemLocation.classList.add('selected-home-location');


                localStorage.setItem('DefaultLocation', JSON.stringify({ lat: location.lat, lon: location.lon, name: location.locationName }));

            });

            savedLocationsMenu.appendChild(menuItemLocation);
        });

        const checkName = JSON.parse(localStorage.getItem('DefaultLocation'));

        if (!localStorage.getItem('DefaultLocation')) {
            localStorage.setItem('DefaultLocation', JSON.stringify({ name: 'CurrentDeviceLocation' }));
        } else if (checkName.lat && checkName.lon) {
            clearSelection();
            document.querySelector(`[name="${checkName.name}"]`).classList.add('selected-home-location')
        } else {

        }
}
        document.addEventListener('DOMContentLoaded', () =>{
            function checkInterNetForDevice(){
        if(navigator.onLine){
            document.querySelector('.device_location').style.pointerEvents = ''
            document.querySelector('.device_location').style.opacity = ''
             document.querySelector('.device_location p').innerHTML = getTranslationByLang(localStorage.getItem("AppLanguageCode"), 'your_device_location');


        } else{
            document.querySelector('.device_location').style.pointerEvents = 'none'
            document.querySelector('.device_location').style.opacity = '0.5'
            document.querySelector('.device_location p').innerHTML = getTranslationByLang(localStorage.getItem("AppLanguageCode"), 'your_device_location') + ' (' + getTranslationByLang(localStorage.getItem("AppLanguageCode"), 'network_unavailable') + ')';

        }
    }

    window.addEventListener('online', checkInterNetForDevice)
    window.addEventListener('offline', checkInterNetForDevice)
    checkInterNetForDevice()

    });

        function openInfoDialog() {
  document.getElementById("storage_info_dialog").show();
  window.history.pushState({ AppStorageInfoDialogOpen: true }, "");

      if (document.getElementById("headUser-1").scrollTop >= 50) {
    sendThemeToAndroid(colorsDialogsOpenContainer[GetDialogOverlayContainerColor()], colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], '0', '200');
  } else {
    sendThemeToAndroid(colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], '0', '200');
  }
}

window.addEventListener("popstate", function (event) {
  if (document.getElementById("storage_info_dialog").open) {
    document.getElementById("storage_info_dialog").close();
  }
});

document
  .getElementById("storage_info_dialog")
  .addEventListener("cancel", () => {
    document
      .getElementById("storage_info_dialog")
      .addEventListener("closed", () => {
        window.history.back();
      });
  });

document
  .getElementById("storage_info_dialog")
  .addEventListener("close", () => {
  if (document.getElementById("headUser-1").scrollTop >= 50) {
    sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface-Container'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '210')
  } else {
    sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '210')
  }
  });

        function calculateLocalStorageUsageInMB() {
    let totalUsed = 0;

    // Calculate total size of all items in local storage
    for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
            totalUsed += (localStorage[key].length + key.length) * 2; // 2 bytes per character
        }
    }

    const maxStorageLimitMB = 5;
    const maxStorageLimitBytes = 5 * 1024 * 1024;

    const totalUsedMB = totalUsed / (1024 * 1024);
    const usagePercentage = (totalUsed / maxStorageLimitBytes) * 100;

    return {
        totalUsedMB: totalUsedMB.toFixed(2).replace('.', local),
        maxStorageLimitMB: maxStorageLimitMB,
        usagePercentage: usagePercentage.toFixed(2).replace('.', local),
        usagePercentageRegular: usagePercentage.toFixed(2)

    };
}

const usageInfo = calculateLocalStorageUsageInMB();


if(usageInfo.usagePercentageRegular < 30){
    document.querySelector('.used_storage').classList.add('lowStorage');
    document.querySelector('.used_storage').classList.remove('highStorage');
    document.querySelector('.used_storage').classList.remove('midStorage');

} else if (usageInfo.usagePercentageRegular > 30 && usageInfo.usagePercentageRegular < 70){
    document.querySelector('.used_storage').classList.add('midStorage');
    document.querySelector('.used_storage').classList.remove('lowStorage');
    document.querySelector('.used_storage').classList.remove('highStorage');

} else{
    document.querySelector('.used_storage').classList.add('highStorage');
    document.querySelector('.used_storage').classList.remove('midStorage');
    document.querySelector('.used_storage').classList.remove('lowStorage');

}


setTimeout(() =>{
    document.querySelector('.storage_progress').style.width = `${usageInfo.usagePercentageRegular}%`;
document.getElementById('storage_progress_text_span').innerHTML = `${usageInfo.usagePercentage}%`

}, 200);

// prompt


function openDeletelocationsDialog() {
  document.getElementById("delete_all_locations_dialog").show();
  window.history.pushState({ DeleteAllLocationsDialogOpen: true }, "");

  if (document.getElementById("headUser-1").scrollTop >= 50) {
    sendThemeToAndroid(colorsDialogsOpenContainer[GetDialogOverlayContainerColor()], colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], '0', '200');
  } else {
    sendThemeToAndroid(colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], '0', '200');
  }
}

window.addEventListener("popstate", function (event) {
  if (document.getElementById("delete_all_locations_dialog").open) {
    document.getElementById("delete_all_locations_dialog").close();
  }
});

document
  .getElementById("delete_all_locations_dialog")
  .addEventListener("cancel", () => {
    document
      .getElementById("delete_all_locations_dialog")
      .addEventListener("closed", () => {
        window.history.back();
      });
  });

document
  .getElementById("delete_all_locations_dialog")
  .addEventListener("close", () => {
  if (document.getElementById("headUser-1").scrollTop >= 50) {
    sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface-Container'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '210')
  } else {
    sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '210')
  }
  });

function deleteSavedLocations(){

        setTimeout(() =>{
        document.getElementById('delete_all_locations_btn').disabled = true
    }, 100);

    let savedLocations = JSON.parse(localStorage.getItem('savedLocations') || '[]');
    let RemovedsavedLocations = JSON.parse(localStorage.getItem('savedLocations') || '[]');

    const defaultLocation = JSON.parse(localStorage.getItem('DefaultLocation'));


savedLocations = savedLocations.filter(location => location.locationName === defaultLocation.name);
RemovedsavedLocations = RemovedsavedLocations.filter(location => location.locationName !== defaultLocation.name);



localStorage.setItem('savedLocations', JSON.stringify(savedLocations));


RemovedsavedLocations.forEach((RemovedsavedLocation) =>{


if (
            localStorage.getItem(
              `WeatherDataOpenMeteo_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataOpenMeteo_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataMetNorway_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataMetNorway_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataAccuCurrent_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataAccuCurrent_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataAccuHourly_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataAccuHourly_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataMetNorwayTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataMetNorwayTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataAccuTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataAccuTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataOpenMeteoTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataOpenMeteoTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (localStorage.getItem(`AlertData_${RemovedsavedLocation.locationName}`)) {
            setTimeout(() => {
              localStorage.removeItem(`AlertData_${RemovedsavedLocation.locationName}`);
            }, 400);
          }
          if (localStorage.getItem(`AstronomyData_${RemovedsavedLocation.locationName}`)) {
            setTimeout(() => {
              localStorage.removeItem(`AstronomyData_${RemovedsavedLocation.locationName}`);
            }, 400);
          }
          if (
            localStorage.getItem(`MoreDetailsData_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `MoreDetailsData_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCall_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCall_${location.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallMet_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallMet_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataDWDGermany_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataDWDGermany_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(`WeatherDataNOAAUS_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataNOAAUS_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataMeteoFrance_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataMeteoFrance_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(`WeatherDataECMWF_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataECMWF_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataukMetOffice_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataukMetOffice_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(`WeatherDatajmaJapan_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatajmaJapan_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDatagemCanada_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatagemCanada_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDatabomAustralia_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatabomAustralia_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(`WeatherDatacmaChina_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatacmaChina_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDataknmiNetherlands_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataknmiNetherlands_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `WeatherDatadmiDenmark_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatadmiDenmark_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          // last call

          if (
            localStorage.getItem(
              `DecodeWeatherLastCalldwdGermany_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCalldwdGermany_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallopenmeteo_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallopenmeteo_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallnoaaUS_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallnoaaUS_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallmeteoFrance_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallmeteoFrance_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallecmwf_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallecmwf_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallukMetOffice_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallukMetOffice_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCalljmaJapan_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCalljmaJapan_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallgemCanada_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallgemCanada_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallbomAustralia_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallbomAustralia_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallcmaChina_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallcmaChina_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCallknmiNetherlands_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCallknmiNetherlands_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }
          if (
            localStorage.getItem(
              `DecodeWeatherLastCalldmiDenmark_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `DecodeWeatherLastCalldmiDenmark_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          // remove any other data
          if (
            localStorage.getItem(`HourlyWeatherCache_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `HourlyWeatherCache_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (localStorage.getItem(`AstronomyData_${RemovedsavedLocation.locationName}`)) {
            setTimeout(() => {
              localStorage.removeItem(`AstronomyData_${RemovedsavedLocation.locationName}`);
            }, 400);
          }

          if (
            localStorage.getItem(`MoreDetailsData_${RemovedsavedLocation.locationName}`)
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `MoreDetailsData_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (localStorage.getItem(`AlertData_${RemovedsavedLocation.locationName}`)) {
            setTimeout(() => {
              localStorage.removeItem(`AlertData_${RemovedsavedLocation.locationName}`);
            }, 400);
          }

          if (localStorage.getItem(`AirQuality_${RemovedsavedLocation.locationName}`)) {
            setTimeout(() => {
              localStorage.removeItem(`AirQuality_${RemovedsavedLocation.locationName}`);
            }, 400);
          }

          // time stamps

          if (
            localStorage.getItem(
              `WeatherDataMeteoFranceTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataMeteoFranceTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataDWDGermanyTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataDWDGermanyTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataNOAAUSTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataNOAAUSTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataECMWFTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataECMWFTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataukMetOfficeTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataukMetOfficeTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataJMAJapanTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataJMAJapanTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDatagemCanadaTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatagemCanadaTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDatabomAustraliaTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatabomAustraliaTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDatacmaChinaTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatacmaChinaTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDataknmiNetherlandsTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDataknmiNetherlandsTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

          if (
            localStorage.getItem(
              `WeatherDatadmiDenmarkTimeStamp_${RemovedsavedLocation.locationName}`
            )
          ) {
            setTimeout(() => {
              localStorage.removeItem(
                `WeatherDatadmiDenmarkTimeStamp_${RemovedsavedLocation.locationName}`
              );
            }, 400);
          }

        })

        setTimeout(() =>{
            window.history.back()
        }, 400);

    setTimeout(() =>{
        sendThemeToAndroid('ReloadLocations');
    }, 600);


}

    let OriginalsavedLocationName

function editLocationName(event){
  event.stopPropagation();
  document.getElementById('editLocationNameDialog').show();
       document.getElementById('inputLocationName').error = false;

  window.history.pushState({ editLocationNameDialogOpen: true }, "");

  if (document.getElementById("headUser-1").scrollTop >= 50) {
    sendThemeToAndroid(colorsDialogsOpenContainer[GetDialogOverlayContainerColor()], colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], '0', '200');
  } else {
    sendThemeToAndroid(colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], colorsDialogsOpenSurface[GetDialogOverlayContainerColor()], '0', '200');
  }



  document.getElementById('inputLocationName').value = event.srcElement.attributes.customName.nodeValue

  OriginalsavedLocationName = event.srcElement.attributes.OriginaleditLocationName.nodeValue;


}

function saveCustomLocatioName() {

  if(!document.getElementById('inputLocationName').value.trim()){
    console.log('empty')
    document.getElementById('inputLocationName').setAttribute('error', getTranslationByLang(localStorage.getItem("AppLanguageCode"),"edit_location_error_sub"))
    document.getElementById('inputLocationName').error = true;
    return
  }

  let savedLocations = JSON.parse(localStorage.getItem("savedLocationsCustomName")) || {};
  let originalName = OriginalsavedLocationName;
  let customName = document.getElementById('inputLocationName').value;

  if(customName !== originalName){
    savedLocations[originalName] = customName;
  } else{
    console.log('same name')
  }

  localStorage.setItem("savedLocationsCustomName", JSON.stringify(savedLocations));

    window.history.back();

renderSavedLocationsHome();
}


function resetLocationCustomName() {
    let savedLocations = JSON.parse(localStorage.getItem("savedLocationsCustomName")) || {};
    let originalName = OriginalsavedLocationName;

    delete savedLocations[originalName];

    localStorage.setItem("savedLocationsCustomName", JSON.stringify(savedLocations));

    document.getElementById('inputLocationName').value = OriginalsavedLocationName;

    window.history.back();

renderSavedLocationsHome();
}

document
  .getElementById("editLocationNameDialog")
  .addEventListener("cancel", () => {
    document
      .getElementById("editLocationNameDialog")
      .addEventListener("closed", () => {
        window.history.back();
      });
  });

document
  .getElementById("editLocationNameDialog")
  .addEventListener("close", () => {
  if (document.getElementById("headUser-1").scrollTop >= 50) {
    sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface-Container'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '210')
  } else {
    sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), Themeflag, '210')
  }
  });

  window.addEventListener("popstate", function (event) {
  if (document.getElementById("editLocationNameDialog").open) {
    document.getElementById("editLocationNameDialog").close();
  }
});


    </script>


    <script src="../components-script.js/components.js"></script>
    <script src="../ripple-files/icon-ripple.js"></script>
    <script src="../modules/scroll.js"></script>
    <script src="../modules/ripple_acc.js"></script>
    <script src="../app/navigate.js"></script>
    <script src="bundle.js"></script>
    <script type="module" src="../index.js"></script>
</body>

</html>