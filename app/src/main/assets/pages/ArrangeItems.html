<!DOCTYPE html>
<html lang="en" Theme="blue_material" data-theme="dark" >

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Arrange items Page</title>
    <script src="../bridge/android.js"></script>
    <script src="../database/MainDataBase.js"></script>
    <script src="../langs/langs.js"></script>
    <script src="../modules/Sortable.min.js"></script>
    <link rel="stylesheet" href="../ui-files/ui.css">
    <link rel="stylesheet" href="../ui-files/font-usage.css">
    <link rel="stylesheet" href="../ui-files/variables.css">
    <link rel="stylesheet" href="../components/components.css">
    <link rel="stylesheet" href="../ripple-files/ripple.css">
    <link rel="stylesheet" href="../components/md-buttons.css">
    <script src="../modules/lottie.js"></script>
    <link rel="stylesheet" href="../components/modal-ver.css">
    <script>
          if(localStorage.getItem('useLightTheme') && localStorage.getItem('useLightTheme') === 'true'){
        document.documentElement.setAttribute('colorTheme', 'light');
        }
  </script>
    <style>
            .padding_about_app{
                padding: 15px;
                overflow: auto;
                height: calc(100vh - 0px - 70px - 90px);
                padding-top: 10px;
                padding-bottom: 80px !important;
            }

            .head_area_about_page{
                display: flex;
                align-items: center;
                justify-content: space-between;
                font-size: 26px;
                color: var(--On-Surface);
                font-family: var(--google-normal);
                padding: 15px;
                position: relative;
                background-color: var(--Surface);
            }
            p{
                margin: 0;
            }


        .remove_item_main_cards, .remove_item_main_widget_cards {
            transition: all 0.2s ease-in;
        }

        .remove_item_main_cards.hidden-item, .remove_item_main_widget_cards.hidden-item {
            background-color: var(--Error);
            --md-icon-button-icon-color: var(--On-Error);
            --md-icon-button-focus-icon-color: var(--On-Error);
            --md-icon-button-hover-icon-color: var(--On-Error);
            --md-icon-button-pressed-icon-color: var(--On-Error);
            border-radius: 50px;
        }


        .remove_item_main_cards, .remove_item_main_widget_cards {
            background-color: var(--Surface-Container-Low);
            --md-icon-button-icon-color: var(--On-Surface);
            --md-icon-button-focus-icon-color: var(--On-Surface);
            --md-icon-button-hover-icon-color: var(--On-Surface);
            --md-icon-button-pressed-icon-color: var(--On-Surface);
            border-radius: 10px;
        }

        .drag_handle, .drag_handle_remove_widget{
            width: calc(100% - 30px);
            height: 40px;
            background-color: var(--Surface-Container);
            color: var(--Inverse-On-Primary);
            border-radius: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            margin-bottom: 8px;
            z-index: 1;
            gap: 10px;
            font-family: var(--google-mid);
            font-size: 17px;
            color: var(--On-Surface);
            transition: background-color 0.2s ease-out, border-radius 0.2s ease-out;
        }

        .drag_handle div, .drag_handle_remove_widget div {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .drag_handle div:first-child md-icon, .drag_handle_remove_widget div:first-child md-icon{
            background-color: var(--Tertiary-Container);
            color: var(--On-Tertiary-Container);

            border-radius: 50px;
            padding: 5px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        .save_btn_arranged {
            position: fixed;
            z-index: 99;
            bottom: 20px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }


        .padding_about_app::before {
            position: fixed;
            bottom: 0;
            content: '';
            width: 100%;
            background: linear-gradient(0deg, var(--Surface) 10%, rgba(255, 0, 0, 0));
            height: 30px;
            z-index: 10;
        }

                .custom-chosen-class{
            background-color: var(--Primary-Container);
            color: var(--On-Primary-Container);
        }
    </style>
</head>

<body class="center_all" style="--md-list-item-label-text-size: 1.15rem; --md-list-item-pressed-state-layer-opacity: 0.15; --md-ref-typeface-plain: var(--google-normal); background-color: var(--Surface); overflow: hidden;" hidden>
<div class="head_area_about_page">
    <p data-translate="arrange_items">Arrange items</p>
    <md-icon-button onclick="ActivityBack()"><md-icon icon-outlined>close</md-icon></md-icon-button>
</div>
<div class="padding_about_app">

    <div id="all_el">
        <div class="drag_handle" data-id="1">
            <div>
                <md-icon icon-outlined>drag_handle</md-icon>
                <p data-translate="hourly_forecast">Hourly forecast</p>
            </div>
            <div>
                <md-icon-button hide-value="hourly_forecast_box" class="remove_item_main_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle" data-id="2">
            <div>

                <md-icon icon-outlined>drag_handle</md-icon>
                <p data-translate="daily_forecast">Daily forecast</p>
            </div>
            <div>
                <md-icon-button hide-value="daily_forecast_box" class="remove_item_main_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle" data-id="3">
            <div>
                <md-icon icon-outlined>drag_handle</md-icon>
                <p data-translate="current_conditions">Current conditions</p>
            </div>
            <div>
                <md-icon-button hide-value="current_conditions_box" class="remove_item_main_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>

        </div>

        <div class="drag_handle" data-id="4">
            <div>
                <md-icon icon-outlined>drag_handle</md-icon>
                <p data-translate="pollen_data">Pollen data</p>
            </div>
            <div>
                <md-icon-button hide-value="pollen_data_box" class="remove_item_main_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>

        </div>

        <div class="drag_handle" data-id="5">
            <div>
                <md-icon icon-outlined>drag_handle</md-icon>
                <p data-translate="air_quality_index">Air quality index</p>
            </div>
            <div>
                <md-icon-button hide-value="air_quality_index_box" class="remove_item_main_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle" data-id="6">
            <div>
                <md-icon icon-outlined>drag_handle</md-icon>
                <p data-translate="uv_index">UV index</p>
            </div>
            <div>
                <md-icon-button hide-value="uv_index_box" class="remove_item_main_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>
    </div>
    <div class="arrange_condition_widgets_wrap">
        <p class="title" style="margin-bottom: 5px;" data-translate="hide_condition_widgets">Hide condition widgets</p>

        <div class="drag_handle_remove_widget">
            <div>
                <md-icon icon-outlined>wb_twilight</md-icon>
                <p data-translate="sun_tile_page">Sun</p>
            </div>
            <div>
                <md-icon-button hide-value="sun_widget_box" class="remove_item_main_widget_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle_remove_widget">
            <div>
                <md-icon icon-outlined>bedtime</md-icon>
                <p data-translate="moon">Moon</p>
            </div>
            <div>
                <md-icon-button hide-value="moon_widget_box" class="remove_item_main_widget_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle_remove_widget">
            <div>
                <md-icon icon-outlined>humidity_low</md-icon>
                <p data-translate="humidity">Humidity</p>
            </div>
            <div>
                <md-icon-button hide-value="humidity_widget_box" class="remove_item_main_widget_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle_remove_widget">
            <div>
                <md-icon icon-outlined>visibility</md-icon>
                <p data-translate="visibility">Visibility</p>
            </div>
            <div>
                <md-icon-button hide-value="visibility_widget_box" class="remove_item_main_widget_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle_remove_widget">
            <div>
                <md-icon icon-outlined>explore</md-icon>
                <p data-translate="direction">Direction</p>
            </div>
            <div>
                <md-icon-button hide-value="direction_widget_box" class="remove_item_main_widget_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>

        <div class="drag_handle_remove_widget">
            <div>
                <md-icon icon-outlined>compress</md-icon>
                <p data-translate="pressure">Pressure</p>
            </div>
            <div>
                <md-icon-button hide-value="pressure_widget_box" class="remove_item_main_widget_cards">
                    <md-icon icon-filled>
                        remove
                    </md-icon>
                </md-icon-button>
            </div>
        </div>
    </div>
</div>

<div class="save_btn_arranged">
    <md-filled-tonal-button onclick="ResetOrder()" data-translate="reset">Reset</md-filled-tonal-button>
    <md-filled-button data-translate="save" onclick="saveOrder()" id="saveHiddenItems">Save</md-filled-button>
</div>
<script>

    // -------------------
    let sortableInstance;

async function initializeDragAndDropAllELDrag() {
  const draggableContainer = document.getElementById('all_el');
  const storageKey = 'dragAndDropStateAllEL';

  async function loadOrder() {
      const storedState = await customStorage.getItem(storageKey);
      if (storedState) {
          const itemsOrder = JSON.parse(storedState);
          const elements = Array.from(draggableContainer.children);

          itemsOrder.forEach(id => {
              const element = elements.find(el => el.dataset.id === id);
              if (element) {
                  draggableContainer.appendChild(element);
              }
          });
      }
  }
  let timeoutID;

    if (sortableInstance) {
    sortableInstance.destroy();
  }
  sortableInstance = new Sortable(draggableContainer, {
      animation: 250,
    //   handle: 'drag_handle',
      ghostClass: 'sortable-ghost',
       chosenClass: 'custom-chosen-class',
      delay: 200,
      onStart(evt) {

        evt.item.classList.add('drag');
    },
      onEnd(evt) {
        clearTimeout(timeoutID);

        timeoutID = setTimeout(() => {
          evt.item.classList.remove('drag');
        }, 200);
      },
  });
  await loadOrder();
}
initializeDragAndDropAllELDrag()


function hexToRgb(hex) {
    const bigint = parseInt(hex.slice(1), 16);
    return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255
    };
}

function rgbToHsl({ r, g, b }) {
    r /= 255;
    g /= 255;
    b /= 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
        h = s = 0; // Achromatic
    } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }

    return { h: h * 360, s: s * 100, l: l * 100 };
}

async function CreateMaterialYouTheme(hex) {
    const colors = {
        orange_material: "#FFA500",
        red_material: "#FF0000",
        pink_material: "#FFC0CB",
        purple_material: "#800080",
        blue_material: "#0000FF",
        yellow_material: "#FFFF00",
        green_material: "#008000",
        mono_material: "#e2e2e2"
    };

    const targetHsl = rgbToHsl(hexToRgb(hex));
    let closestColor = null;
    let smallestHueDifference = Infinity;

    for (const [color, colorHex] of Object.entries(colors)) {
        const colorHsl = rgbToHsl(hexToRgb(colorHex));
        const hueDifference = Math.abs(targetHsl.h - colorHsl.h);
        if (targetHsl.s < 10) {
            closestColor = "mono_material";
            break;
        }
        if (hueDifference < smallestHueDifference) {
            smallestHueDifference = hueDifference;
            closestColor = color;
        }
    }

 if(localStorage.getItem("useDynamicColors") && localStorage.getItem("useDynamicColors") === "false"){
  if (await customStorage.getItem("customTheme")) {
    document.documentElement.setAttribute(
      "Theme",
      await customStorage.getItem("customTheme")
    );
  } else{
    document.documentElement.setAttribute(
     "Theme",
        "blue_material"
   );
     await customStorage.setItem("customTheme", "blue_material");
  }

      if(localStorage.getItem('useLightTheme') && localStorage.getItem('useLightTheme') === 'true'){
        document.documentElement.setAttribute('colorTheme', 'light');
        sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '1')

      } else{
        document.documentElement.setAttribute('colorTheme', 'dark');
        sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '0')
      }
        document.querySelector('body').hidden = false
        AndroidFunctionActivityInterface.androidFunction('hideSurfaceOverlay');

  } else{
          document.documentElement.setAttribute(
      "Theme",
      await customStorage.getItem("customTheme")
    );

if(localStorage.getItem('useLightTheme') && localStorage.getItem('useLightTheme') === 'true'){
  document.documentElement.setAttribute('colorTheme', 'light');
  sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '1')

} else{
  document.documentElement.setAttribute('colorTheme', 'dark');
  sendThemeToAndroid(getComputedStyle(document.documentElement).getPropertyValue('--Surface'), getComputedStyle(document.documentElement).getPropertyValue('--Surface'), '0')
}
  document.querySelector('body').hidden = false
        AndroidFunctionActivityInterface.androidFunction('hideSurfaceOverlay');

  }
}


        const AppLanguageCodeValue = localStorage.getItem('AppLanguageCode');
        if (AppLanguageCodeValue) {
            applyTranslations(AppLanguageCodeValue);

        }



        async function saveOrder() {
            const draggableContainer = document.getElementById('all_el');
            const storageKey = 'dragAndDropStateAllEL';
            const itemsOrder = Array.from(draggableContainer.children).map(element => element.dataset.id);
            await customStorage.setItem(storageKey, JSON.stringify(itemsOrder));

            await customStorage.setItem('LoadNewOrder', new Date().getTime())

            setTimeout( async() =>{
                ActivityBack();
            }, 100);
        }

        async function ResetOrder() {
        const draggableContainer = document.getElementById('all_el');
        const storageKey = 'dragAndDropStateAllEL';

const itemsOrder = Array.from(draggableContainer.children).map((_, index) => (index + 1).toString());
await customStorage.setItem(storageKey, JSON.stringify(itemsOrder));




            draggableContainer.innerHTML = `
    <div class="drag_handle" data-id="1">
        <div>
        <md-icon icon-outlined>drag_handle</md-icon>
        <p data-translate="hourly_forecast">Hourly forecast</p></div>
        <div >
            <md-icon-button hide-value="hourly_forecast_box" class="remove_item_main_cards">
                <md-icon icon-filled>
                    remove
                </md-icon>
            </md-icon-button></div>
    </div>

    <div class="drag_handle" data-id="2">
        <div>

        <md-icon icon-outlined>drag_handle</md-icon>
        <p data-translate="daily_forecast">Daily forecast</p></div>
        <div >
            <md-icon-button hide-value="daily_forecast_box" class="remove_item_main_cards">
                <md-icon icon-filled>
                    remove
                </md-icon>
            </md-icon-button></div>
    </div>

    <div class="drag_handle" data-id="3">
        <div>
            <md-icon icon-outlined>drag_handle</md-icon>
        <p data-translate="current_conditions">Current conditions</p></div>
        <div >
            <md-icon-button hide-value="current_conditions_box" class="remove_item_main_cards">
                <md-icon icon-filled>
                    remove
                </md-icon>
            </md-icon-button></div>

    </div>

    <div class="drag_handle" data-id="4">
        <div>
            <md-icon icon-outlined>drag_handle</md-icon>
        <p data-translate="pollen_data">Pollen data</p></div>
        <div >
            <md-icon-button hide-value="pollen_data_box" class="remove_item_main_cards">
                <md-icon icon-filled>
                    remove
                </md-icon>
            </md-icon-button></div>

    </div>

    <div class="drag_handle" data-id="5">
        <div>
            <md-icon icon-outlined>drag_handle</md-icon>
        <p data-translate="air_quality_index">Air quality index</p></div>
        <div>
            <md-icon-button hide-value="air_quality_index_box" class="remove_item_main_cards">
                <md-icon icon-filled>
                    remove
                </md-icon>
            </md-icon-button></div>
    </div>

    <div class="drag_handle" data-id="6">
        <div>
            <md-icon icon-outlined>drag_handle</md-icon>
        <p data-translate="uv_index">UV index</p></div>
        <div>
            <md-icon-button hide-value="uv_index_box" class="remove_item_main_cards">
                <md-icon icon-filled>
                    remove
                </md-icon>
            </md-icon-button></div>
    </div>
            `

                        applyTranslations(AppLanguageCodeValue);

    initializeHiddenCards();


            setTimeout(async() =>{
                initializeDragAndDropAllELDrag()
                 await customStorage.setItem('LoadNewOrder', new Date().getTime())
            }, 100);
        }


               async function initializeHiddenCards() {
    const remove_item_main_cards_btns = document.querySelectorAll('.remove_item_main_cards');
    let hiddenCards = [];

    try {
        const storedValue = await customStorage.getItem('hidden_cards');
        hiddenCards = JSON.parse(storedValue) || [];
        if (!Array.isArray(hiddenCards)) {
            hiddenCards = [];
        }
    } catch (error) {
        hiddenCards = [];
    }

    remove_item_main_cards_btns.forEach(remove_item_main_cards_btn => {
        const hideValue = remove_item_main_cards_btn.getAttribute('hide-value');
        if (hiddenCards.includes(hideValue)) {
            remove_item_main_cards_btn.classList.add('hidden-item');
            remove_item_main_cards_btn.innerHTML = '<md-icon icon-filled>add</md-icon>';
        }

        remove_item_main_cards_btn.addEventListener('click', async () => {
            const valueIndex = hiddenCards.indexOf(hideValue);

            if (valueIndex === -1) {
                if (hiddenCards.length < 3) {
                    hiddenCards.push(hideValue);
                    remove_item_main_cards_btn.classList.add('hidden-item');
                    remove_item_main_cards_btn.innerHTML = '<md-icon icon-filled>add</md-icon>';
                } else {
                        ShowSnackMessage.ShowSnack(getTranslationByLang(localStorage.getItem("AppLanguageCode"), 'max_items_3'), "short");

                }

            } else {
                hiddenCards.splice(valueIndex, 1);
                remove_item_main_cards_btn.classList.remove('hidden-item');
                remove_item_main_cards_btn.innerHTML = '<md-icon icon-filled>remove</md-icon>';
            }
        });
    });

    const saveButton = document.getElementById('saveHiddenItems');
    if (saveButton) {
        saveButton.addEventListener('click', async () => {
            await customStorage.setItem('hidden_cards', JSON.stringify(hiddenCards));
        });
    }
}

initializeHiddenCards();

        // ----------------


        async function initializeHiddenWidgetCards() {
            const remove_item_main_cards_btns = document.querySelectorAll('.remove_item_main_widget_cards');
            let hiddenCards = [];

            try {
                const storedValue = await customStorage.getItem('hidden_widget_cards');
                hiddenCards = JSON.parse(storedValue) || [];
                if (!Array.isArray(hiddenCards)) {
                    hiddenCards = [];
                }
            } catch (error) {
                hiddenCards = [];
            }

            remove_item_main_cards_btns.forEach(remove_item_main_cards_btn => {
                const hideValue = remove_item_main_cards_btn.getAttribute('hide-value');
                if (hiddenCards.includes(hideValue)) {
                    remove_item_main_cards_btn.classList.add('hidden-item');
                    remove_item_main_cards_btn.innerHTML = '<md-icon icon-filled>add</md-icon>';
                }

                remove_item_main_cards_btn.addEventListener('click', async () => {
                    const valueIndex = hiddenCards.indexOf(hideValue);

                    if (valueIndex === -1) {
                        if (hiddenCards.length < 4) {
                            hiddenCards.push(hideValue);
                            remove_item_main_cards_btn.classList.add('hidden-item');
                            remove_item_main_cards_btn.innerHTML = '<md-icon icon-filled>add</md-icon>';
                        } else {
                            ShowSnackMessage.ShowSnack(getTranslationByLang(localStorage.getItem("AppLanguageCode"), 'max_items_4'), "short");

                        }
                    } else {
                        hiddenCards.splice(valueIndex, 1);
                        remove_item_main_cards_btn.classList.remove('hidden-item');
                        remove_item_main_cards_btn.innerHTML = '<md-icon icon-filled>remove</md-icon>';
                    }
                });
            });

            const saveButton = document.getElementById('saveHiddenItems');
            if (saveButton) {
                saveButton.addEventListener('click', async () => {
                    await customStorage.setItem('hidden_widget_cards', JSON.stringify(hiddenCards));
                });
            }
        }


            initializeHiddenWidgetCards();



    </script>


<script src="../app/navigate.js"></script>
<script src="../modules/ripple_acc.js"></script>
<script src="../components-script.js/components.js"></script>
<script src="../ripple-files/icon-ripple.js"></script>
<script src="../modules/scroll.js"></script>
<script  src="bundle.js"></script>
<script type="module" src="../index.js"></script>
<script src="../ripple-files/ripples.js"></script>
<script src="../app/apply.js"></script>
</body>

</html>